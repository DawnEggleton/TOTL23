<!DOCTYPE html>
<html>
    <head>
        <title>Site Name</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!--Styles-->
        <link rel="stylesheet" href="../dist/css/styles.css" />

        <!--Fonts-->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Averia+Serif+Libre:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet"> 
        

        <!--Icons-->
		<link href="https://dawneggleton.github.io/css/all.css" rel="stylesheet" />

        <!--Script Libraries-->
		<script type='text/javascript' src='https://files.jcink.net/html/jquery-1.7.2.min.js'></script>
		<script type='text/javascript' src='https://files.jcink.net/html/jquery.cookie-1.3.1.js'></script> 
		<script type='text/javascript' src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/2.2.2/isotope.pkgd.min.js"></script>
        <script src="../dist/js/clipboard.js"></script>
        <script src="../dist/js/functions.js"></script>

        <!--Settings-->
        <script type='text/javascript' src='../dist/js/settings.js'></script>
        <link rel="stylesheet" href="../dist/css/settings.css" />
    </head>
    <body id="Members" class="g-4">
        
<a name="to-top"></a><div class="background noise">
</div>
<!--Header-->
        <header></header>

        <!--Navigation-->
        <div id="clip-nav"></div>

        <!--Main Body-->
        <main>
            <script type='text/javascript' src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/2.2.2/isotope.pkgd.min.js"></script>
            <section class="ml">
                <div class="ml--header">
                    <input id="quicksearch" class="forminput memberlist-namesearch" type="text" size="25" name="name" value="" placeholder="Filter by name...">
                    <div class="ml--sort-buttons">
                        <button type="button" class="ml--sort is-checked" data-sort="name">Name<br>(A -> Z)</button>
                        <button type="button" class="ml--sort" data-sort="nameDesc">Name<br>(Z -> A)</button>
                        <button type="button" class="ml--sort" data-sort="age">Age<br>(Asc)</button>
                        <button type="button" class="ml--sort" data-sort="ageDesc">Age<br>(Desc)</button>
                        <span class="pagination"><span class="pagination_pagetxt"><a title="Jump to page..." href="javascript:multi_page_jump('https://totl.jcink.net/index.php?&amp;act=Members&amp;photoonly=&amp;name=&amp;name_box=all&amp;max_results=1000&amp;filter=ALL&amp;sort_order=asc&amp;sort_key=name',2020,1000);">Pages:</a> (3)</span>&nbsp;<span class="pagination_current"><b>1</b></span>&nbsp;<a href="https://totl.jcink.net/index.php?&amp;act=Members&amp;photoonly=&amp;name=&amp;name_box=all&amp;max_results=1000&amp;filter=ALL&amp;sort_order=asc&amp;sort_key=name&amp;st=1000" class="pagination_page">2</a>&nbsp;<a href="https://totl.jcink.net/index.php?&amp;act=Members&amp;photoonly=&amp;name=&amp;name_box=all&amp;max_results=1000&amp;filter=ALL&amp;sort_order=asc&amp;sort_key=name&amp;st=2000" class="pagination_page">3</a>&nbsp;</span>
                    </div>
                </div>
                <div class="ml--wrapper">
                    <div class="ml--filters">
                        <button>
                            <i class="fa-light fa-filter-list"></i>
                            <i class="fa-light fa-xmark"></i>
                        </button>
                        <div class="scroll">
                            <div class="ml--filter">
                                <a href="javascript:;" class="is-open">
                                    <i class="fa-light fa-plus"></i>
                                    <i class="fa-light fa-minus"></i>
                                    <span>Member</span>
                                </a>
                                <div class="ml--filter-group claim--labels ml-memberlist" data-filter-group="member">
                                    <label class="all is-checked"><input type="checkbox" class="all" value="" checked="">all members</label>
                                </div>
                            </div>
                            <div class="ml--filter">
                                <a href="javascript:;">
                                    <i class="fa-light fa-plus"></i>
                                    <i class="fa-light fa-minus"></i>
                                    <span>Group</span>
                                </a>
                                <div class="ml--filter-group claim--labels" data-filter-group="group">
                                    <label class="all is-checked"><input type="checkbox" class="all" value="" checked="">all groups</label>
                                    <label><input type="checkbox" value=".g-6">adults</label>
                                    <label><input type="checkbox" value=".g-18">entertainment</label>
                                    <label><input type="checkbox" value=".g-7">gryffindor</label>
                                    <label><input type="checkbox" value=".g-15">healers</label>
                                    <label><input type="checkbox" value=".g-8">hogwarts staff</label>
                                    <label><input type="checkbox" value=".g-9">hufflepuff</label>
                                    <label><input type="checkbox" value=".g-12">ministry</label>
                                    <label><input type="checkbox" value=".g-11">press</label>
                                    <label><input type="checkbox" value=".g-13">quidditch</label>
                                    <label><input type="checkbox" value=".g-14">ravenclaw</label>
                                    <label><input type="checkbox" value=".g-17">returners</label>
                                    <label><input type="checkbox" value=".g-16">slytherin</label>
                                    <label><input type="checkbox" value=".g-4">site staff</label>
                                    <label><input type="checkbox" value=".g-20">members</label>
                                    <label><input type="checkbox" value=".g-3">unsorted</label>
                                    <label><input type="checkbox" value=".g-19">hiatus</label>
                                    <label><input type="checkbox" value=".g-10">inactive</label>
                                </div>
                            </div>
                            <div class="ml--filter">
                                <a href="javascript:;">
                                    <i class="fa-light fa-plus"></i>
                                    <i class="fa-light fa-minus"></i>
                                    <span>Age</span>
                                </a>
                                <div class="ml--filter-group claim--labels" data-filter-group="age">
                                    <label class="all is-checked"><input type="checkbox" class="all" value="" checked="">all ages</label>
                                    <label><input type="checkbox" value=".Teen">Teens</label>
                                    <label><input type="checkbox" value=".20s">20 - 29</label>
                                    <label><input type="checkbox" value=".30s">30 - 39</label>
                                    <label><input type="checkbox" value=".40s">40 - 49</label>
                                    <label><input type="checkbox" value=".50">50+</label>
                                </div>
                            </div>
                            <div class="ml--filter">
                                <a href="javascript:;">
                                    <i class="fa-light fa-plus"></i>
                                    <i class="fa-light fa-minus"></i>
                                    <span>Blood Status</span>
                                </a>
                                <div class="ml--filter-group claim--labels" data-filter-group="blood">
                                    <label class="all is-checked"><input type="checkbox" class="all" value="" checked="">all types</label>
                                    <label><input type="checkbox" value=".pureblood">pureblood</label>
                                    <label><input type="checkbox" value=".halfblood">halfblood</label>
                                    <label><input type="checkbox" value=".muggleborn">muggleborn</label>
                                    <label><input type="checkbox" value=".squib">squib</label>
                                    <label><input type="checkbox" value=".muggle">muggle</label>
                                    <label><input type="checkbox" value=".other">other</label>
                                </div>
                            </div>
                            <div class="ml--filter">
                                <a href="javascript:;">
                                    <i class="fa-light fa-plus"></i>
                                    <i class="fa-light fa-minus"></i>
                                    <span>Relationship Status</span>
                                </a>
                                <div class="ml--filter-group claim--labels ml-relationship" data-filter-group="relationship">
                                    <label class="all is-checked"><input type="checkbox" class="all" value="" checked="">all statuses</label>
                                </div>
                            </div>
                            <div class="ml--filter">
                                <a href="javascript:;">
                                    <i class="fa-light fa-plus"></i>
                                    <i class="fa-light fa-minus"></i>
                                    <span>Pronouns</span>
                                </a>
                                <div class="ml--filter-group claim--labels ml-pronouns" data-filter-group="pronouns">
                                    <label class="all is-checked"><input type="checkbox" class="all" value="" checked="">all pronouns</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ml--content">
                        <div class="ml--members scroll">
                            <form action='index.php' method='get'>
                                <input type='hidden' name='act' value='Members' />
                                <div id="ml--rows"><div class="grid-sizer"></div></div>
                            </form>
                        </div>
                    </div>
                </div>
                <script>
                    let accounts = [], members = [];
                    var filters = {};
                    let charAge = `0`, ageClass = ``;

                    //set class variables
                    let $container = $('#ml--rows');
                    let typeSearch = `#quicksearch`;
                    let memName = `.mem--top a`;
                    let visible = `is-visible`;
                    let filterGroup = `.ml--filter-group`;
                    let filterOptions = `.ml--filter-group input`;
                    let sorts = `.ml--header button`;
                    let gridItem = `.grid-item`;
                    let defaultShow = `.character:not(.g-3)`;

                    function formatMemberRow(accountType, classArray, image, id, accountName, lines, long) {
                        let classList = classArray.join(' ');
                        let html = `<div class="ml--member ${accountType} grid-item ${classList}">
                            <div class="mem">
                                <div class="mem--top">
                                    <div class="mem--image noise"><img src="${image}" loading="lazy" /></div>
                                    <a href="?showuser=${id}" class="name">${accountName}</a>`;
                        lines.forEach(line => {
                            if(Array.isArray(line)) {
                                html += `<span class="${line[1]}">${line[0]}</span>`;
                            } else {
                                html += `<span>${line}</span>`;
                            }
                        });
                        html += `</div>
                                <div class="mem--overview">
                                    <div class="scroll">${long}</div>
                                </div>
                            </div>
                        </div>`;

                        return html;
                    }

                    function populatePage(array) {
                        let html = ``;
                        let members = [], membersClean = [];
                        let pronouns = [], pronounsClean = [];
                        let rels = [], relsClean = [];
                        for (let i = 0; i < array.length; i++) {
                            //Make Member Array
                            let member = {raw: array[i].rawAlias, clean: array[i].alias};
                            let pronoun = {raw: array[i].charPronouns, clean: array[i].charPronounsClass};
                            let relationship = {raw: array[i].relationship, clean: array[i].relationshipClass};
                            if(jQuery.inArray(member.clean, membersClean) == -1 && member.clean != '') {
                                membersClean.push(member.clean);
                                members.push(member);
                            }
                            if(jQuery.inArray(pronoun.clean, pronounsClean) == -1 && pronoun.clean != '') {
                                pronounsClean.push(pronoun.clean);
                                pronouns.push(pronoun);
                            }
                            if(jQuery.inArray(relationship.clean, relsClean) == -1 && relationship.clean != '') {
                                relsClean.push(relationship.clean);
                                rels.push(relationship);
                            }
                            switch(array[i].groupID) {
                                //member only
                                case 4:
                                case 20:
                                    html += formatMemberRow('member', [`g-${array[i].groupID}`, array[i].alias], array[i].image, array[i].id, array[i].name, [array[i].groupName, array[i].pronouns, array[i].timezone, array[i].contact], array[i].triggers);
                                    break;
                                //depends on type
                                case 1:
                                case 3:
                                case 5:
                                case 10:
                                case 19:
                                case 21:
                                    if(array[i].type == `member`) {
                                        html += formatMemberRow('member', [`g-${array[i].groupID}`, array[i].alias], array[i].image, array[i].id, array[i].name, [array[i].groupName, array[i].pronouns, array[i].timezone, array[i].contact], array[i].triggers);
                                    } else {
                                        //character
                                        html += formatMemberRow('character', [`g-${array[i].groupID}`, array[i].ageClass, array[i].bloodStatus, array[i].alias, array[i].charPronounsClass, array[i].relationshipClass], array[i].image, array[i].id, array[i].name, [[`${array[i].age} years old`, 'age'], `${array[i].bloodStatus} — ${array[i].groupName}`, `${array[i].charPronouns} — ${array[i].relationship}`, `Played by ${array[i].rawAlias}`], array[i].overview);
                                    }
                                    break;
                                //character only
                                default: 
                                    html += formatMemberRow('character', [`g-${array[i].groupID}`, array[i].ageClass, array[i].bloodStatus, array[i].alias, array[i].charPronounsClass, array[i].relationshipClass], array[i].image, array[i].id, array[i].name, [[`${array[i].age} years old`, 'age'], `${array[i].bloodStatus} — ${array[i].groupName}`, `${array[i].charPronouns} — ${array[i].relationship}`, `Played by ${array[i].rawAlias}`], array[i].overview);
                                    break;
                            }
                        }
                        document.querySelector('#ml--rows').insertAdjacentHTML('beforeend', html);

                        //sort member array
                        members.sort();

                        //Append Array
                        members.forEach(member => {
                            document.querySelector('.ml-memberlist').insertAdjacentHTML('beforeend', `<label><input type="checkbox" value=".${member.clean}"/>${member.raw}</label>`);
                        });
                        pronouns.forEach(pronoun => {
                            document.querySelector('.ml-pronouns').insertAdjacentHTML('beforeend', `<label><input type="checkbox" value=".${pronoun.clean}"/>${pronoun.raw}</label>`);
                        });
                        rels.forEach(rel => {
                            document.querySelector('.ml-relationship').insertAdjacentHTML('beforeend', `<label><input type="checkbox" value=".${rel.clean}"/>${rel.raw}</label>`);
                        });
                        console.log(pronouns);
                        console.log(rels);
                    }

                    function setCustomFilter() {
                        //get search value
                        qsRegex = document.querySelector(typeSearch).value;
                        
                        //add show class to all items to reset
                        elements.forEach(el => el.classList.add(visible));
                        
                        //filter by nothing
                        let searchFilter = '';
                        
                        //check each item
                        elements.forEach(el => {
                            let name = el.querySelector(memName).textContent;
                            if(!name.toLowerCase().includes(qsRegex)) {
                                el.classList.remove(visible);
                                searchFilter = `.${visible}`;
                            }
                        });
                    
                        let filterGroups = document.querySelectorAll(filterGroup);
                        let groups = [];
                        let checkFilters;
                        filterGroups.forEach(group => {
                            let filters = [];
                            group.querySelectorAll('label.is-checked input').forEach(filter => {
                                if(filter.value) {
                                    filters.push(filter.value);
                                }
                            });
                            groups.push({group: group.dataset.filterGroup, selected: filters});
                        });
                    
                        let filterCount = 0;
                        let comboFilters = [];
                        groups.forEach(group => {
                            // skip to next filter group if it doesn't have any values
                            if ( group.selected.length > 0 ) {
                                if ( filterCount === 0 ) {
                                    // copy groups to comboFilters
                                    comboFilters = group.selected;
                                } else {
                                    var filterSelectors = [];
                                    var groupCombo = comboFilters;
                                    // merge filter Groups
                                    for (var k = 0; k < group.selected.length; k++) {
                                        for (var j = 0; j < groupCombo.length; j++) {
                                            //accommodate weirdness with object vs not
                                            if(groupCombo[j].selected) {
                                                if(groupCombo[j].selected != group.selected[k]) {
                                                    filterSelectors.push( groupCombo[j].selected + group.selected[k] );
                                                }
                                            } else if (!groupCombo[j].selected && group.selected[k]) {
                                                if(groupCombo[j] != group.selected[k]) {
                                                    filterSelectors.push( groupCombo[j] + group.selected[k] );
                                                }
                                            }
                                        }
                                    }
                                    // apply filter selectors to combo filters for next group
                                    comboFilters = filterSelectors;
                                }
                                filterCount++;
                            }
                        });
                        
                        //set filter to blank
                        let filter = [];
                        //check if it's only search
                        if(qsRegex.length > 0 && comboFilters.length === 0) {
                            filter = [`.${visible}`];
                        }
                        //check if it's only checkboxes
                        else if(qsRegex.length === 0 && comboFilters.length > 0) {
                            let combos = comboFilters.join(',').split(',');
                            filter = [...combos];
                        }
                        //check if it's both
                        else if (qsRegex.length > 0 && comboFilters.length > 0) {
                            let dualFilters = comboFilters.map(filter => filter + `.${visible}`);
                            filter = [...dualFilters];
                        }
                    
                        //join array into string
                        filter = filter.join(', ');
                        
                        //render isotope
                        $container.isotope({
                            filter: filter
                        });
                    }
                
                    // debounce so filtering doesn't happen every millisecond
                    function debounce(fn, threshold) {
                        var timeout;
                        return function debounced() {
                            if (timeout) {
                            clearTimeout(timeout);
                            }
                    
                            function delayed() {
                            fn();
                            timeout = null;
                            }
                            setTimeout(delayed, threshold || 100);
                        };
                    }
                </script>
                <script src="./templates/accounts.js"></script>
                <script>
                    populatePage(accounts);

                    //initialize isotope
                    // quick search regex
                    let qsRegex;
                    let elements = document.querySelectorAll(gridItem);
                    
                    // init Isotope
                    $(window).on('load', function() {
                        $container.isotope({
                            itemSelector: gridItem,
                            percentPosition: true,
                            masonry: {
                                columnWidth: '.grid-sizer',
                                gutter: 15
                            },
                            filter: defaultShow,
                            getSortData: {
                                name: '.name',
                                nameDesc: '.name',
                                age: '.age parseInt',
                                ageDesc: '.age parseInt',
                            },
                            sortAscending: {
                                name: true,
                                nameDesc: false,
                                age: true,
                                ageDesc: false,
                            }
                        });
                    });
                
                    //use value of input select to filter
                    let checkboxes = document.querySelectorAll(filterOptions);
                    checkboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', e => {
                            if(e.currentTarget.classList.contains('all')) {
                                e.currentTarget.checked = true;
                                e.currentTarget.parentElement.classList.add('is-checked');
                                e.currentTarget.parentElement.parentElement.querySelectorAll('input:not(.all)').forEach(input => {
                                    input.checked = false;
                                    input.parentElement.classList.remove('is-checked');
                                });
                            } else {
                                if(e.currentTarget.parentElement.classList.contains('is-checked')) {
                                    e.currentTarget.checked = false;
                                    e.currentTarget.parentElement.classList.remove('is-checked');
                                } else {
                                    e.currentTarget.checked = true;
                                    e.currentTarget.parentElement.classList.add('is-checked');
                                    e.currentTarget.parentElement.parentElement.querySelector('input.all').checked = false;
                                    e.currentTarget.parentElement.parentElement.querySelector('input.all').parentElement.classList.remove('is-checked');
                                }
                            }
                            let labels = e.currentTarget.parentElement.parentElement.querySelectorAll('label');
                            let checked = 0;
                            labels.forEach(label => {
                                if(label.classList.contains('is-checked')) {
                                    checked++;
                                }
                            });
                            if(checked === 0) {
                                e.currentTarget.parentElement.parentElement.querySelector('input.all').checked = true;
                                e.currentTarget.parentElement.parentElement.querySelector('input.all').parentElement.classList.add('is-checked');
                            }
                            //set filters
                            setCustomFilter();
                        });
                    });
                    
                    // use value of search field to filter
                    document.querySelector(typeSearch).addEventListener('keyup', e => {
                        setCustomFilter();
                    });

                    // bind sort button click
                    let sortButtons = document.querySelectorAll(sorts);
                    sortButtons.forEach(button => {
                        button.addEventListener('click', e => {
                            let sortValue = e.currentTarget.dataset.sort;
                            $container.isotope({ sortBy: sortValue });
                            sortButtons.forEach(button => {
                                button.classList.remove('is-checked');
                            });
                            e.currentTarget.classList.add('is-checked');
                        });
                    });
                </script>
            </section>
        <a name="to-bottom"></a></main>

        <!-- Copyright Information -->
        <div class="tableborder" align="center">
            <div class="row4" style="font-size: 7.5pt; padding-top: 1px; padding-bottom: 1px; line-height: 8pt;">
                <div class="copyright" align="center">
                    Powered by 
                    <a href="https://www.invisionboard.com" target="_blank">Invision Power Board</a>
                    (<a href="http://jcink.com" target="_blank">Jcink.com </a>
                    <a href="https://jcink.com" target="_blank">Forum Hosting</a>
                    ) © 2020 &nbsp;
                    <a href="https://www.invisionpower.com" target="_blank">IPS, Inc.</a>
                    <br>
                    Page creation time: 0.0054 <!-- http://luxtradition.b1.jcink.com -->  · 
                    <a href="index.php?act=Mobile">Mobile Version</a> · 
                    <a href="index.php?act=privacy">Privacy Policy</a>
                </div>
            </div>
        </div> 

        <!--Templates-->
        <script src="templates/header.js"></script>
        <script src="templates/nav.js"></script>

        <!--Scripts-->
        <script src="../dist/js/scripts.js"></script>
    </body>
</html>